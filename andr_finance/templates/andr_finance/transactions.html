{% extends "andr_finance/base.html" %}

{% block content %}

    <h2>Транзакции:</h2>

    <form action="{% url 'andr_finance:transactions' %}" method='get'>
        {% csrf_token %}
        <label for="filter_account" class="form-label">Счет:</label>
        <select name="filter_account" id="filter_account" class="form-select">

            {# todo: Правильно?: id - нулём не может быть?   #}
            <option
                    value="0"
                    {% if filter_account == '0' %}
                    selected
                    {% endif %}
            >--- Не выбрано ---
            </option>

            {% for account in accounts %}
                <option
                        value="{{ account.id }}"
                        {% if filter_account == account.id|stringformat:"s" %}
                        selected
                        {% endif %}
                >{{ account.name }}</option>
            {% endfor %}
        </select>
        <button name="submit" class="btn btn-outline-primary btn-sm mt-2">Отобрать по счету</button>
    </form>

    <table class="table table-hover mt-3">
        <thead>
        <tr>
            <th scope="col">+ / -</th>
            <th scope="col">Категория</th>
            <th scope="col">Дата</th>
            <th scope="col">Сумма</th>
            <th scope="col">Счет</th>
            <th scope="col">Описание</th>
            <th scope="col">Редактировать</th>
            <th scope="col">Удалить</th>
        </tr>
        </thead>
        <tbody>
        {% for transaction in transactions %}
            <tr>
                <td>
                    {% if transaction.change == 'receipt' %}
                        -
                    {% elif transaction.change == 'expense' %}
                        +
                    {% elif transaction.change == 'transfer' %}
                        Перевод
                    {% endif %}
                </td>
                <td>{{ transaction.category.name }}</td>
                <td>{{ transaction.date_added|date:"d.m.Y H:m" }}</td>
                <td class="td_right">{{ transaction.amount|floatformat:"2g"}}</td>
                <td>{{ transaction.account.name }}</td>
                <td>{{ transaction.title }}</td>
                <td><a
                        href="{% url 'andr_finance:transaction_edit' transaction.id %}">Редактировать</a></td>
                <td><a href="{% url 'andr_finance:transaction_delete' transaction.id %}">Удалить</a>
                </td>
            </tr>
        {% empty %}
            <tr>
                <td>Нет транзакций</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        {% endfor %}
        </tbody>
        <tfoot>
        <tr>
            <th colspan="3">Итого</th>
            <th class="td_right">{{ total_amount }} {{ total_currency_name }}</th>
            <th colspan="4"></th>
        </tr>
        </tfoot>
    </table>

    <form action="{% url 'andr_finance:transaction_add' %}">
        <button type="submit" class="btn btn-outline-primary btn-sm mt-2">Добавить новую транзакцию</button>
    </form>

{% endblock content %}